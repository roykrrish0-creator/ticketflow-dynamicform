<div class="form-section-container">
  <mat-expansion-panel 
    [expanded]="!section.collapsed"
    class="section-panel">
    
    <!-- Section Header -->
    <mat-expansion-panel-header class="section-header">
      <mat-panel-title class="section-title">
        <mat-icon class="section-icon w-6 h-6">{{ getSectionIcon() }}</mat-icon>
        <span class="section-title-text">{{ section.title }}</span>
      </mat-panel-title>
    </mat-expansion-panel-header>

    <!-- Section Content -->
    <div class="section-content" [formGroup]="formGroup">
      <div class="form-grid">
        <div 
          *ngFor="let field of section.fields; trackBy: trackByFieldId"
          class="form-field-container"
          [ngClass]="getFieldGridClass(field)">
          
          <!-- Text Input -->
          <mat-form-field 
            *ngIf="field.type === 'text'" 
            appearance="outline"
            class="form-field">
            <mat-label>{{ field.label }}</mat-label>
            <input 
              matInput 
              [formControlName]="field.id"
              [placeholder]="field.placeholder || ''"
              [readonly]="field.readOnly"
              [type]="getInputType(field)"
              [attr.autocomplete]="getFieldAttribute(field, 'autocomplete')">
            <mat-hint *ngIf="field.attributes?.hint">{{ getFieldAttribute(field, 'hint') }}</mat-hint>
            <mat-error *ngIf="hasFieldError(field.id, 'required')">
              {{ getValidationMessage(field, 'required') }}
            </mat-error>
            <mat-error *ngIf="hasFieldError(field.id, 'email')">
              {{ getValidationMessage(field, 'email') }}
            </mat-error>
            <mat-error *ngIf="hasFieldError(field.id, 'minlength')">
              {{ getValidationMessage(field, 'minlength') }}
            </mat-error>
            <mat-error *ngIf="hasFieldError(field.id, 'maxlength')">
              {{ getValidationMessage(field, 'maxlength') }}
            </mat-error>
            <mat-error *ngIf="hasFieldError(field.id, 'pattern')">
              {{ getValidationMessage(field, 'pattern') }}
            </mat-error>
          </mat-form-field>

          <!-- Textarea -->
          <mat-form-field 
            *ngIf="field.type === 'textarea'" 
            appearance="outline"
            class="form-field full-width">
            <mat-label>{{ field.label }}</mat-label>
            <textarea 
              matInput 
              [formControlName]="field.id"
              [placeholder]="field.placeholder || ''"
              [rows]="field.attributes?.rows || 3"
              [readonly]="field.readOnly"
              [attr.maxlength]="getFieldAttribute(field, 'maxlength')">
            </textarea>
            <mat-hint *ngIf="field.attributes?.hint">{{ getFieldAttribute(field, 'hint') }}</mat-hint>
            <mat-error *ngIf="hasFieldError(field.id, 'required')">
              {{ getValidationMessage(field, 'required') }}
            </mat-error>
            <mat-error *ngIf="hasFieldError(field.id, 'minlength')">
              {{ getValidationMessage(field, 'minlength') }}
            </mat-error>
            <mat-error *ngIf="hasFieldError(field.id, 'maxlength')">
              {{ getValidationMessage(field, 'maxlength') }}
            </mat-error>
          </mat-form-field>

          <!-- Select -->
          <mat-form-field 
            *ngIf="field.type === 'select'" 
            appearance="outline"
            class="form-field">
            <mat-label>{{ field.label }}</mat-label>
            <mat-select [formControlName]="field.id" [disabled]="isFieldDisabled(field)">
              <mat-option 
                *ngFor="let option of getFieldOptions(field); trackBy: trackByOptionValue" 
                [value]="option.value"
                [disabled]="option.disabled">
                {{ option.label }}
              </mat-option>
            </mat-select>
            <mat-hint *ngIf="field.attributes?.hint">{{ getFieldAttribute(field, 'hint') }}</mat-hint>
            <mat-error *ngIf="hasFieldError(field.id, 'required')">
              {{ getValidationMessage(field, 'required') }}
            </mat-error>
          </mat-form-field>

          <!-- Radio Group -->
          <div *ngIf="field.type === 'radio'" class="radio-group full-width">
            <label class="field-label">{{ field.label }}</label>
            <mat-radio-group 
              [formControlName]="field.id" 
              class="radio-group-content"
              [disabled]="isFieldDisabled(field)">
              <mat-radio-button 
                *ngFor="let option of getFieldOptions(field); trackBy: trackByOptionValue"
                [value]="option.value"
                [disabled]="option.disabled"
                class="radio-option">
                {{ option.label }}
              </mat-radio-button>
            </mat-radio-group>
            <div *ngIf="field.attributes?.hint" class="field-hint">{{ getFieldAttribute(field, 'hint') }}</div>
            <div *ngIf="hasFieldError(field.id, 'required')" class="field-error">
              {{ getValidationMessage(field, 'required') }}
            </div>
          </div>

          <!-- Number Input -->
          <mat-form-field 
            *ngIf="field.type === 'number'" 
            appearance="outline"
            class="form-field">
            <mat-label>{{ field.label }}</mat-label>
            <input 
              matInput 
              type="number"
              [formControlName]="field.id"
              [placeholder]="field.placeholder || ''"
              [readonly]="field.readOnly"
              [min]="getFieldAttribute(field, 'min')"
              [max]="getFieldAttribute(field, 'max')"
              [step]="getFieldAttribute(field, 'step')">
            <mat-hint *ngIf="field.attributes?.hint">{{ getFieldAttribute(field, 'hint') }}</mat-hint>
            <mat-error *ngIf="hasFieldError(field.id, 'required')">
              {{ getValidationMessage(field, 'required') }}
            </mat-error>
            <mat-error *ngIf="hasFieldError(field.id, 'min')">
              {{ getValidationMessage(field, 'min') }}
            </mat-error>
            <mat-error *ngIf="hasFieldError(field.id, 'max')">
              {{ getValidationMessage(field, 'max') }}
            </mat-error>
          </mat-form-field>

          <!-- Date Input -->
          <mat-form-field 
            *ngIf="field.type === 'date'" 
            appearance="outline"
            class="form-field">
            <mat-label>{{ field.label }}</mat-label>
            <input 
              matInput 
              [matDatepicker]="picker"
              [formControlName]="field.id"
              [readonly]="field.readOnly"
              [min]="getFieldAttribute(field, 'min')"
              [max]="getFieldAttribute(field, 'max')">
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-hint *ngIf="field.attributes?.hint">{{ getFieldAttribute(field, 'hint') }}</mat-hint>
            <mat-error *ngIf="hasFieldError(field.id, 'required')">
              {{ getValidationMessage(field, 'required') }}
            </mat-error>
            <mat-error *ngIf="hasFieldError(field.id, 'matDatepickerMin')">
              Date must be after minimum allowed date
            </mat-error>
            <mat-error *ngIf="hasFieldError(field.id, 'matDatepickerMax')">
              Date must be before maximum allowed date
            </mat-error>
          </mat-form-field>

          <!-- Checkbox -->
          <div *ngIf="field.type === 'checkbox'" class="checkbox-field">
            <mat-checkbox 
              [formControlName]="field.id" 
              [disabled]="isFieldDisabled(field)">
              {{ field.label }}
            </mat-checkbox>
            <div *ngIf="field.attributes?.hint" class="field-hint">{{ getFieldAttribute(field, 'hint') }}</div>
          </div>

        </div>
      </div>
    </div>
  </mat-expansion-panel>
</div>
